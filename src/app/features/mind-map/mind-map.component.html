<div class="mind-map-container">
  <svg
    class="mind-map-svg"
    viewBox="0 0 100 100"
    preserveAspectRatio="xMidYMid meet"
  >

    <!-- Glow -->
    <defs>
      <filter id="glow">
        <feGaussianBlur stdDeviation="0.6" result="blur" />
        <feMerge>
          <feMergeNode in="blur" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>
    </defs>

    <!-- Connection Lines -->
    @for (pos of domainPositions(); track pos.node.id) {
      <line
        x1="50"
        y1="50"
        [attr.x2]="pos.x"
        [attr.y2]="pos.y"
        [attr.stroke]="isNodeActive(pos.node.id) ? pos.node.color : '#00d4ff'"
        [attr.stroke-width]="isNodeActive(pos.node.id) ? '0.4' : '0.25'"
        [attr.opacity]="isNodeActive(pos.node.id) ? '1' : '0.6'"
        class="connection-line"
        [class.active-line]="isNodeActive(pos.node.id)"
      />
    }

    <!-- Root Node -->
    @if (rootNode(); as root) {
      <g
        class="node-group root-node"
        [class.active]="isNodeActive(root.id)"
        [class.inactive]="!isNodeActive(root.id) && selectedNode()"
        transform="translate(50 50)"
        (click)="onNodeClick(root, $event)"
        [@nodeAnimation]="getNodeAnimationState(root.id)"
      >
        <circle
          r="6"
          [attr.fill]="root.color"
          filter="url(#glow)"
          class="node-circle"
          [class.pulse]="isNodeActive(root.id)"
        />
        <text
          y="10"
          text-anchor="middle"
          dominant-baseline="middle"
          class="node-label root-label"
        >
          {{ root.title }}
        </text>
      </g>
    }

    <!-- Domain Nodes -->
    @for (pos of domainPositions(); track pos.node.id) {
      <g
        class="node-group domain-node"
        [class.active]="isNodeActive(pos.node.id) || isDomainOfSelectedSubtopic(pos.node.id)"
        [class.inactive]="!isNodeActive(pos.node.id) && !isDomainOfSelectedSubtopic(pos.node.id) && selectedNode()"
        [attr.transform]="pos.transform"
        (click)="onNodeClick(pos.node, $event)"
        [@nodeAnimation]="getNodeAnimationState(pos.node.id)"
      >
        <circle
          r="5"
          [attr.fill]="pos.node.color"
          filter="url(#glow)"
          class="node-circle"
          [class.pulse]="isNodeActive(pos.node.id) || isDomainOfSelectedSubtopic(pos.node.id)"
        />
        <text
          y="-7"
          text-anchor="middle"
          dominant-baseline="middle"
          class="node-label domain-label"
        >
          {{ pos.node.title }}
        </text>
      </g>
    }

  </svg>
</div>
